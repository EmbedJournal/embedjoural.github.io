---
title: Programming a Line Follower Robot
date: 2013-06-04T22:46:31+00:00
author: Siddharth
layout: post
thumbnail: post-thumb.jpg
permalink: /programming-line-follower-robot/
dsq_thread_id: "2701837863"
categories: [ "Robotics", "Programming" ]
tags: [ "DIY", "LFR" ]
---

Programming a Line Follower Robot is the next step that you should do after building it. This is a follow-up on my previous post <span style="text-decoration: underline;"><a title="Line Follower Robot aEUR" Build it from scratch" href="http://embedjournal.com/line-follower-robot/" target="_blank">Line Follower Robot - Build it from scratch</a></span>. If you haven't already read it, I suggest you read it before going any further in this post.

When it comes to programming a line follower robot doesn't mean you can just copy paste a bunch of code from somewhere and say you are done programming dY~> You have to calibrate the code to work properly with the hardware you have built. So the first step in programming is to make a demo track. This will help you test your code then and there. Here is the track that I built for my line follower.

<p style="text-align: center;">
  <a href="/images/posts/2013/06/DSC08202.jpg"><img class="aligncenter size-large wp-image-358" src="/images/posts/2013/06/DSC08202-1024x576.jpg" alt="Line Follower Track" width="620" height="348" srcset="/images/posts/2013/06/DSC08202-1024x576.jpg 1024w, /images/posts/2013/06/DSC08202-300x169.jpg 300w" sizes="(max-width: 620px) 100vw, 620px" /></a>
</p>

The line is little over 3.5 cm in width and has almost all possible turns and bends. I used a black chart paper to make the track and stuck it over white one. You can come up with you own innovative ideas but this is the most straight forward method I can think of. I you have a better Idea leave a comment.

The next step is to sit with a pen and paper and make reading from the track that you just made. If you had used the circuit diagram that I posted or something similar, you should be having some indication LED's at the output of the comparators like this one here,

<p style="text-align: center;">
  <a href="/images/posts/2013/06/DSC08214.jpg"><img class="aligncenter size-large wp-image-359" src="/images/posts/2013/06/DSC08214-1024x576.jpg" alt="Line Follower sensor" width="620" height="348" srcset="/images/posts/2013/06/DSC08214-1024x576.jpg 1024w, /images/posts/2013/06/DSC08214-300x169.jpg 300w" sizes="(max-width: 620px) 100vw, 620px" /></a>
</p>

I placed the output LED'sA (green) directly above the line sensor to avoid confusion. This made my board look really bad. Again was a trade-off between the look and the feature, I choose the feature. It is really helpful if those LED's are right on top of the sensors.

# How is the line is sensed?

The IRA emitter emits a constant IR beam. The white surface reflects most of the beam while theA blackA surface absorbs most of the beam. This reflected beam is picked up by the IR detector and its conduction increases and hence a voltage variation in the output pin (0v for absence of IR rays and 5v forA maximumA intensity). This is given to the comparator to compare with a reference signal generated by the potentiometer. That is how the line is sensed by the sensors.

Back to the post, you have to place the bot over the line and see what it reads for various position of the line. Make sure that the line always detected at least by one sensor if is within the range of the three sensors. This is something you should take utmost care. I even mentioned in my previous post the maximum distance between the sensors should not exceed the width of the line.

With the calibration values at hand, you can start programming you robot. In your while(1) loop you should have a series of if statements which polls of these calibrated condition and make direction changes accordingly.

Let's assume these are the only four possible conditions for the sake of understanding. The red dots are the sensors that are just above the A black line and the green ones are on the white background.

<p style="text-align: center;">
  <a href="/images/posts/2013/06/line-follower-logic.png"><img class="aligncenter wp-image-362" src="/images/posts/2013/06/line-follower-logic.png" alt="line follower robot logic" width="761" height="306" srcset="/images/posts/2013/06/line-follower-logic.png 761w, /images/posts/2013/06/line-follower-logic-300x121.png 300w" sizes="(max-width: 761px) 100vw, 761px" /></a>
</p>

Case 1 is when the robot has to move front as only the center sensor is low. Similarly Case 2 is right, Case 3 is left and case 4 is stop as all the sensors read high. This is how your code should look like (the terms, LEFT\_SENSOR, RIGHT\_SENSOR, CENTER\_SENSOR, GO\_FRONT, TURN\_RIGHT, TURN\_LEFT, STOP are all code macros for the corresponding pin in the microcontroller).

<pre class="lang:c decode:true">while (1)
{
    if((LEFT_SENSOR==1)&&(CENTER_SENSOR==0)&&(RIGHT_SENSOR==1))
        LATB |= GO_FRONT; // Case 1
    if ((LEFT_SENSOR==0)&&(CENTER_SENSOR==1)&&(RIGHT_SENSOR==1))
        LATB |= TURN_RIGHT // Case 2
    if ((LEFT_SENSOR==1)&&(CENTER_SENSOR==1)&&(RIGHT_SENSOR==0))
        LATB |= TURN_LEFT // Case 3
    if ((LEFT_SENSOR==1)&&(CENTER_SENSOR==1)&&(RIGHT_SENSOR==1))
        LATB |= STOP; // case 4
}// End of while(1)</pre>

This code should be good for any linear track with normal bends. But this is not going to work if your track has right and acute angle turns. That is when we have to add some more logic to the existing one.

Say you are facing a right angle, what would your sensor data read? The center sensor along with either of the two side sensors will read LOW. This is when you have to tweak the direction logic a little.

<p style="text-align: center;">
  <a href="/images/posts/2013/06/Right-Angle-Acute-Angle-Truns.png"><img class="aligncenter wp-image-370" src="/images/posts/2013/06/Right-Angle-Acute-Angle-Truns.png" alt="line follower robot logic" width="764" height="317" srcset="/images/posts/2013/06/Right-Angle-Acute-Angle-Truns.png 764w, /images/posts/2013/06/Right-Angle-Acute-Angle-Truns-300x124.png 300w" sizes="(max-width: 764px) 100vw, 764px" /></a>
</p>

Now you have to define two kinds of left turns. One of it will rotate your right motor forward and the left motor backward. Call this one "Power Left" as it turns left quite fast. The other one is to rotate the right motor forward while the left oneA doesn't rotate at all. Call this just "Left". Do the same thing with the right turn logic.

For normal conditions use the "Left" or "Right" turn. When the bot encounters a right turn or an acute turn use the "Power Left" and "Power Right" this way you bot will respond faster to these cases and act accordingly. Now your code should have these lines too,

<pre class="lang:c decode:true">if ((LEFT_SENSOR==0)&&(CENTER_SENSOR==0)&&(RIGHT_SENSOR==1))
    LATB |= POWER_RIGHT  // Case 2
if ((LEFT_SENSOR==1)&&(CENTER_SENSOR==0)&&(RIGHT_SENSOR==0))
    LATB |= POWER_LEFT   // Case 3</pre>

By adding this logic to yourA controllerA you are able toA tackleA all kinds of bends and turns in a linear track, that is you won't be able to use it on tracks that have intersections andA discontinuities. Almost none of the event in today's trend gives you such a simple track. Don't get annoyed we will discuss some the most common track and how to solve them in my later posts.

# Summary:

Most of the time your robot will have "T" and "X" junctions in the track. You might have to survive a finite discontinuity in track or detectA patternsA in track to do some other tasks (such as glowing an LED or setting up an alarm in the buzzer). Some of them even have inversion in logic (you will be asked to follow white line onA blackA background all of a sudden :-)).

This is just theA beginningA of line follower robot. There are a lot of possible difficulties that can be set up for you in a contest. All cannot be discussed here. But we will discuss some of the most common one (listed above) in the posts to come.

We will specially give importance to the "<a title="this post is now availabe" href="http://embedjournal.com/2013/06/shortest-path-line-follower-robot-logic-revealed/" target="_blank">Shortest Path solving robot</a>" in the near future. Your robot has to go from the source to the destination by travelling any distance but return to the source from the destination but the shortest path only. This is the kind of robots most people have difficulty in programming and there aren't many tutorials online for its kind.

Don't miss the exciting new posts that are yet to come. <a href="http://embedjournal.com/subscribe/" target="_blank">Subscribe to embedjournal.com</a> and get our latest post delivered to your inbox.